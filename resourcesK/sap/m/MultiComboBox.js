/*!
 * SAP UI development toolkit for HTML5 (SAPUI5/OpenUI5)
 * (c) Copyright 2009-2014 SAP AG or an SAP affiliate company. 
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
jQuery.sap.declare("sap.m.MultiComboBox");jQuery.sap.require("sap.m.library");jQuery.sap.require("sap.m.InputBase");sap.m.InputBase.extend("sap.m.MultiComboBox",{metadata:{publicMethods:["isOpen","close","getItemByKey","setSelectedKeys","getSelectedKeys","addSelectedKeys","removeSelectedKeys"],library:"sap.m",properties:{"maxWidth":{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'100%'}},defaultAggregation:"items",aggregations:{"items":{type:"sap.ui.core.Item",multiple:true,singularName:"item"},"popup":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},associations:{"selectedItems":{type:"sap.ui.core.Item",multiple:true,singularName:"selectedItem"}},events:{"selectionChange":{},"selectionFinish":{}}}});sap.m.MultiComboBox.M_EVENTS={'selectionChange':'selectionChange','selectionFinish':'selectionFinish'};jQuery.sap.require("sap.ui.core.EnabledPropagator");jQuery.sap.require("sap.m.MultiComboBoxRenderer");jQuery.sap.require("sap.m.Bar");jQuery.sap.require("sap.m.List");jQuery.sap.require("sap.m.Popover");jQuery.sap.require("sap.m.Dialog");jQuery.sap.require("sap.ui.core.IconPool");jQuery.sap.require("jquery.sap.xml");sap.ui.core.IconPool.insertFontFaceStyle();sap.ui.core.EnabledPropagator.apply(sap.m.MultiComboBox.prototype,[true]);
sap.m.MultiComboBox.prototype.init=function(){sap.m.InputBase.prototype.init.apply(this,arguments);this._setPopupType(sap.ui.Device.system.phone?"Dialog":"Popover");this._oList=this._createList();this._oTokenizer=this._createTokenizer();this._aCustomerKeys=[]};
sap.m.MultiComboBox.prototype._setSelectedItem=function(o){var i=this.getAggregation("items");if(o.item&&this._isItemSelected(o.item)){return}if(i&&this._getKeyOfItems(i).indexOf(o.key)<0){return}if(o.item){this.addAssociation("selectedItems",o.item,o.suppressInvalidate);if(o.fireChangeEvent){this.fireSelectionChange({selectedItem:o.item,selected:true})}if(!o.listItemUpdated&&o.item._oListItem){this._oList.setSelectedItem(o.item._oListItem,true)}this._oTokenizer.addToken(new sap.m.Token({key:o.key,text:o.item.getText()}));this.setValue('')}};
sap.m.MultiComboBox.prototype._removeSelectedItem=function(o){if(o.item&&!this._isItemSelected(o.item)){return}if(o.item){this.removeAssociation("selectedItems",o.item,o.suppressInvalidate);if(o.fireChangeEvent){this.fireSelectionChange({selectedItem:o.item,selected:false})}if(!o.listItemUpdated&&o.item._oListItem){this._oList.setSelectedItem(o.item._oListItem,false)}if(!o.tokenUpdated){this._oTokenizer.removeToken(this._getTokenByKey(o.key))}}};
sap.m.MultiComboBox.prototype._getSuggestedItems=function(v){var i=[];this.getItems().forEach(function(I){if(jQuery.sap.startsWithIgnoreCase(I.getText(),v)){i.push(I)}},this);return i};
sap.m.MultiComboBox.prototype._getDomValue=function(){return jQuery(this.getFocusDomRef()).val()};
sap.m.MultiComboBox.prototype._setContainerSizes=function(){var d=this.getDomRef();if(!d){return}var m=jQuery(d);var s=jQuery(m.children(sap.m.MultiComboBoxRenderer.DOT_CSS_CLASS+"ShadowDiv")[0]);s.text(this._getDomValue());var i=jQuery(m.find(sap.m.MultiComboBoxRenderer.DOT_CSS_CLASS+"InputContainer")[0]);var S=jQuery(m.find(sap.m.MultiComboBoxRenderer.DOT_CSS_CLASS+"ScrollContainer")[0]);var t=this._oTokenizer.$().outerWidth(true);var I=s.outerWidth();var T=S.width();var a=t+I;if(a<T){I=T-t}var w=(I/parseFloat(sap.m.BaseFontSize))+"rem";jQuery(i.find(".sapMInputBaseInner")[0]).css("width",w);this._scrollToEnd()};
sap.m.MultiComboBox.prototype._getTokenByKey=function(k){var t=this._oTokenizer.getTokens();for(var i=0;t&&i<t.length;i++){if(k===t[i].getKey()){return t[i]}}return null};
sap.m.MultiComboBox.prototype._getKeyOfItems=function(I){for(var i=0,k=[];I&&i<I.length;i++){k[i]=I[i].getKey()}return k};
sap.m.MultiComboBox.prototype._getSelectedItemsOf=function(I){for(var i=0,l=I.length,s=[];i<l;i++){if(I[i]._oListItem.isSelected()){s.push(I[i])}}return s};
sap.m.MultiComboBox.prototype._setItemsToVisible=function(v){this.getItems().forEach(function(i){if(i._oListItem){i._oListItem.setVisible(v)}},this)};
sap.m.MultiComboBox.prototype._isItemSelected=function(i){return(this.getSelectedItems().indexOf(i)>-1?true:false)};
sap.m.MultiComboBox.prototype._getPlaceholder=function(c){if(this._oTokenizer.getTokens().length>0){return""}return this.getPlaceholder()};
sap.m.MultiComboBox.prototype._getVisibleItems=function(){return this.getItems().filter(function(i){return i._oListItem&&i._oListItem.getVisible()})};
sap.m.MultiComboBox.prototype._getItemByListItem=function(l){if(!l){return null}return this.getItemByKey(l.data(sap.m.MultiComboBoxRenderer.CSS_CLASS+"ListItemKey"))};
sap.m.MultiComboBox.prototype._getLastSelectedItem=function(){var t=this._oTokenizer.getTokens();var T=t.length?t[t.length-1]:null;if(!T){return null}return this.getItemByKey(T.getKey())};
sap.m.MultiComboBox.prototype._getOrderedSelectedItems=function(){var I=[];for(var i=0,t=this._oTokenizer.getTokens(),l=t.length;i<l;i++){I[i]=this.getItemByKey(t[i].getKey())}return I};
sap.m.MultiComboBox.prototype._mapItemToListItem=function(i){if(!i){return null}var l=sap.m.MultiComboBoxRenderer.CSS_CLASS+"Item";var L=i.getEnabled()?"Enabled":"Disabled";var s=(this._isItemSelected(i))?l+"Selected":"";var o=new sap.m.StandardListItem({title:i.getText(),type:i.getEnabled()?sap.m.ListType.Active:sap.m.ListType.Inactive}).addStyleClass(l+" "+l+L+" "+s);o.data(sap.m.MultiComboBoxRenderer.CSS_CLASS+"ListItemKey",i.getKey());this._decorateListItem(o);i._oListItem=o;return i._oListItem};
sap.m.MultiComboBox.prototype._getFocusedListItem=function(){var f=jQuery(':focus');var F=sap.ui.getCore().byId(f.attr('id'));if(this._oList&&F&&jQuery.sap.containsOrEquals(this._oList.getFocusDomRef(),F.getFocusDomRef())){return F}return null};
sap.m.MultiComboBox.prototype._getFocusedItem=function(){var l=this._getFocusedListItem();return this._getItemByListItem(l)};
sap.m.MultiComboBox.prototype._isRangeSelectionSet=function(l){var L=l.getDomRef();return L.indexOf(sap.m.MultiComboBoxRenderer.CSS_CLASS+"ItemRangeSelection")>-1?true:false};
sap.m.MultiComboBox.prototype._decorateListItem=function(l){l.addDelegate({onkeyup:function(e){var i=null;if(e.which==jQuery.sap.KeyCodes.SPACE&&this.isOpen()&&this._isListInSuggestMode()){this._setItemsToVisible(true);this.open();i=this._getLastSelectedItem();if(i){i._oListItem.focus()}}},onkeydown:function(e){var i=null,j=null;var I=null,o=null,a=null,b=[],O=[];if(e.ctrlKey&&e.which==jQuery.sap.KeyCodes.SPACE){e.setMarked();e.preventDefault();return null}if(e.shiftKey&&e.which==jQuery.sap.KeyCodes.SPACE){O=this._getOrderedSelectedItems();o=this._getFocusedItem();j=O.indexOf(o);if(O.length&&O.indexOf(o)>-1){I=O[O.length-1];i=O.indexOf(I);if(i==j){b=O.splice(0,O.length)}else{b=O.splice(j+1,i)}b.forEach(function(c){this._removeSelectedItem({item:c,id:c.getId(),key:c.getKey(),fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:false})},this);return null}I=this._getLastSelectedItem();if(I){o=this._getItemByListItem(e.srcControl);if(o){i=this.indexOfItem(I);j=this.indexOfItem(o);b=this.getItems().slice(Math.min(i,j),Math.max(i,j)+1);if(i>j){b.reverse()}b.forEach(function(c){this.addSelectedItem(c)},this)}}return null}if(e.shiftKey&&e.which==jQuery.sap.KeyCodes.ARROW_DOWN){a=this._getFocusedItem();return null}if(e.ctrlKey&&e.which==jQuery.sap.KeyCodes.A){e.setMarked();e.preventDefault();var v=this._getVisibleItems();var s=this._getSelectedItemsOf(v);if(s.length!==v.length){v.forEach(function(c){this._setSelectedItem({item:c,id:c.getId(),key:c.getKey(),fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:false})},this)}else{v.forEach(function(c){this._removeSelectedItem({item:c,id:c.getId(),key:c.getKey(),fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:false})},this)}}}},true,this);l.addEventDelegate({onsapshow:function(e){e.setMarked();if(e.keyCode===jQuery.sap.KeyCodes.F4){e.preventDefault()}if(this.isOpen()){this.close();return}if(this.hasContent()){this.open()}},onsaphide:function(e){this.onsapshow(e)},onsapenter:function(e){e.setMarked();this.close()},onsaphome:function(e){e.setMarked();e.preventDefault();var v=this._getVisibleItems();var i=v[0];i._oListItem.focus()},onsapend:function(e){e.setMarked();e.preventDefault();var v=this._getVisibleItems();var i=v[v.length-1];i._oListItem.focus()},onsapup:function(e){e.setMarked();e.preventDefault();var v=this._getVisibleItems();var i=v[0];var I=jQuery(document.activeElement).control()[0];if(I===i._oListItem){this.focus();e.stopPropagation(true)}},onfocusin:function(e){this.addStyleClass(sap.m.MultiComboBoxRenderer.CSS_CLASS+"Focused")},onfocusout:function(e){this.removeStyleClass(sap.m.MultiComboBoxRenderer.CSS_CLASS+"Focused")},onsapfocusleave:function(e){var p=this.getAggregation("popup");var c=sap.ui.getCore().byId(e.relatedControlId);if(p&&c&&jQuery.sap.equal(p.getFocusDomRef(),c.getFocusDomRef())){if(e.srcControl){e.srcControl.focus()}}}},this);if(sap.ui.Device.support.touch){l.addEventDelegate({ontouchstart:function(e){e.setMark("cancelAutoClose")}})}};
sap.m.MultiComboBox.prototype._fillList=function(I){if(!I){return null}for(var i=0,l,a=I.length;i<a;i++){l=this._mapItemToListItem(I[i]);this._oList.addAggregation("items",l,true);if(this._isItemSelected(I[i])){this._oList.setSelectedItem(l)}}};
sap.m.MultiComboBox.prototype._clearList=function(){if(this._oList){this._oList.destroyAggregation("items",true)}};
sap.m.MultiComboBox.prototype._createPopupFactory=function(p){var P=this.getAggregation("popup");if(P){return P}P=this["_create"+p]();this.setAggregation("popup",P,true);P.setHorizontalScrolling(false);P.addStyleClass(sap.m.MultiComboBoxRenderer.CSS_CLASS+"Popup").attachBeforeOpen(this.onBeforeOpen,this).attachAfterOpen(this.onAfterOpen,this).attachBeforeClose(this.onBeforeClose,this).attachAfterClose(this.onAfterClose,this).addEventDelegate({onBeforeRendering:this.onBeforeRenderingPopup,onAfterRendering:this.onAfterRenderingPopup},this);return P};
sap.m.MultiComboBox.prototype._createList=function(){var l=new sap.m.List({width:"100%",mode:sap.m.ListMode.MultiSelect,includeItemInSelection:true,rememberSelections:true}).addStyleClass(sap.m.MultiComboBoxRenderer.CSS_CLASS+"List").attachBrowserEvent("tap",this._handleItemPress,this).attachSelectionChange(this._handleSelectionLiveChange,this);return l};
sap.m.MultiComboBox.prototype._isListInSuggestMode=function(){return this._oList.getItems().some(function(i){return!i.getVisible()})};
sap.m.MultiComboBox.prototype._createPopover=function(){var p=new sap.m.Popover({showHeader:false,placement:sap.m.PlacementType.Vertical,offsetX:0,offsetY:0,initialFocus:this,bounce:false});this._decoratePopover(p);return p};
sap.m.MultiComboBox.prototype._decoratePopover=function(p){var s=this;p._removeArrow=function(){this._marginTop=0;this._marginLeft=0;this._marginRight=0;this._marginBottom=0;this._arrowOffset=0;this._offsets=["0 0","0 0","0 0","0 0"]};p._setPosition=function(){this._myPositions=["begin bottom","begin center","begin top","end center"];this._atPositions=["begin top","end center","begin bottom","begin center"]};p._setArrowPosition=function(){};p._setMinWidth=function(w){this.getDomRef().style.minWidth=w};p._setWidth=function(w){if(sap.ui.Device.system.desktop||sap.ui.Device.system.tablet){this.getContent()[0].setWidth(w)}};p.open=function(){var d=jQuery(s.getDomRef());var b=d.find(sap.m.MultiComboBoxRenderer.DOT_CSS_CLASS+"Border");return this.openBy(b[0])}};
sap.m.MultiComboBox.prototype._createDialog=function(){var C=sap.m.MultiComboBoxRenderer.CSS_CLASS;var d=new sap.m.Dialog({stretchOnPhone:true,customHeader:new sap.m.Bar({contentLeft:new sap.m.InputBase({width:"100%",editable:false}).addStyleClass(C+"Input")}).addStyleClass(C+"Bar")});d.getAggregation("customHeader").attachBrowserEvent("tap",function(){d.close()},this);return d};
sap.m.MultiComboBox.prototype._createTokenizer=function(){var t=new sap.m.Tokenizer({tokens:[]}).attachTokenChange(this._handleTokenChange,this);t.setParent(this);t.addEventDelegate({onAfterRendering:this._onAfterRenderingTokenizer},this);this.getRenderer().placeholderToBeShown=function(r,c){return(!c._oTokenizer.getTokens().length)&&(c.getPlaceholder()?true:false)};return t};
sap.m.MultiComboBox.prototype._setPopupType=function(p){this._sPopupType=p};
sap.m.MultiComboBox.prototype._getPopupType=function(){return this._sPopupType};
sap.m.MultiComboBox.prototype._handleItemPress=function(e){if(e.target.children.length===0){this.close()}};
sap.m.MultiComboBox.prototype._handleSelectionLiveChange=function(e){var l=e.getParameter("listItem");var i=e.getParameter("selected");var n=this._getItemByListItem(l);if(l.getType()==="Inactive"){return null}if(!n){return null}var p={item:n,id:n.getId(),key:n.getKey(),fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:true};if(i){this.fireChangeEvent(n.getText());this._setSelectedItem(p)}else{this._removeSelectedItem(p)}l.focus()};
sap.m.MultiComboBox.prototype._handleTokenChange=function(e){var t=e.getParameter("type");var T=e.getParameter("token");var a=this;var i=null;if(t!==sap.m.Tokenizer.TokenChangeType.Removed&&t!==sap.m.Tokenizer.TokenChangeType.Added){return}if(t===sap.m.Tokenizer.TokenChangeType.Removed){i=(T&&this.getItemByKey(T.getKey()));if(i){this._removeSelectedItem({item:i,id:i.getId(),key:i.getKey(),tokenUpdated:true,fireChangeEvent:true,suppressInvalidate:true});this.focus();this.fireChangeEvent('')}}if(this.isActive()){var d=jQuery(this.getFocusDomRef());if(this._getPlaceholder()===""){d[0].placeholder=""}else{d[0].placeholder=this.getPlaceholder()}}if(!this.isOpen()){this.fireSelectionFinish({selectedItems:this.getSelectedItems()})}};
sap.m.MultiComboBox.prototype.onBeforeOpen=function(){var p=this.getPopup(),P=this["_onBeforeOpen"+this._getPopupType()];this.addStyleClass(sap.m.MultiComboBoxRenderer.CSS_CLASS+"Pressed");p.addContent(this._oList);this.addContent();if(P){P.call(this)}};
sap.m.MultiComboBox.prototype.onAfterOpen=function(){};
sap.m.MultiComboBox.prototype.onBeforeClose=function(){};
sap.m.MultiComboBox.prototype.onAfterClose=function(){this.removeStyleClass(sap.m.MultiComboBoxRenderer.CSS_CLASS+"Pressed");this._setItemsToVisible(true);this.fireSelectionFinish({selectedItems:this.getSelectedItems()})};
sap.m.MultiComboBox.prototype._onAfterRenderingPopover=function(){var p=this.getPopup();var w=(this.$().outerWidth()/parseFloat(sap.m.BaseFontSize))+"rem";p._removeArrow();p._setPosition();p._setMinWidth(sap.ui.Device.system.phone?"100%":w)};
sap.m.MultiComboBox.prototype._onAfterRenderingTokenizer=function(){this._setContainerSizes()};
sap.m.MultiComboBox.prototype.onBeforeRendering=function(){sap.m.InputBase.prototype.onBeforeRendering.apply(this,arguments);var i=this.getItems();this._synchronizeSelectedItemAndKey(i);this._clearList();this._fillList(i)};
sap.m.MultiComboBox.prototype.onAfterRendering=function(){sap.m.InputBase.prototype.onAfterRendering.apply(this,arguments);var p=this.getPopup();var d=jQuery(this.getDomRef());var b=d.find(sap.m.MultiComboBoxRenderer.DOT_CSS_CLASS+"Border");p._oOpenBy=b[0]};
sap.m.MultiComboBox.prototype.exit=function(){sap.m.InputBase.prototype.exit.apply(this,arguments);this._removeFocusableParentPopup(this._getParentPopup());if(this._oList){this._oList.destroy();this._oList=null}};
sap.m.MultiComboBox.prototype.oninput=function(e){sap.m.InputBase.prototype.oninput.apply(this,arguments);var i=this.getItems();var I=e.target;var v=I.value;var V=false;i.forEach(function(o){var m=v!==""&&(o.getText().toLowerCase().indexOf(v.toLowerCase(),0)===0);var l=o._oListItem;if(v===""){m=true}if(l){l.setVisible(m)}if(m&&!V){V=true}},this);if(this._getDomValue()===""||!V){this.close()}else{this.open()}this._setContainerSizes()};
sap.m.MultiComboBox.prototype.ontouchstart=function(e){e.setMarked();if(this.getEnabled()&&this._isOpenArea(e.target)){this.addStyleClass(sap.m.MultiComboBoxRenderer.CSS_CLASS+"Pressed")}};
sap.m.MultiComboBox.prototype.ontouchend=function(e){e.setMarked();if(this.getEnabled()&&(!this.isOpen()||!this.hasContent())){this.removeStyleClass(sap.m.MultiComboBoxRenderer.CSS_CLASS+"Pressed")}};
sap.m.MultiComboBox.prototype.onsapnext=function(e){if(e.isMarked()){return}var f=jQuery(document.activeElement).control()[0];if(!f){return}if(f===this._oTokenizer||this._oTokenizer.$().find(f.$()).length>0){this.focus()}};
sap.m.MultiComboBox.prototype.ontap=function(e){e.setMarked();if(!this.getEnabled()||!this.getEditable()){return null}if(this._isOpenArea(e.target)){if(this.isOpen()){this.close();return null}if(this.hasContent()){this.open()}}};
sap.m.MultiComboBox.prototype.onfocusin=function(e){this.addStyleClass(sap.m.MultiComboBoxRenderer.CSS_CLASS+"Focused");if(e.target===this.getDomRef("arrow")){this.focus()}};
sap.m.MultiComboBox.prototype.onfocusout=function(e){this.removeStyleClass(sap.m.MultiComboBoxRenderer.CSS_CLASS+"Focused");sap.m.InputBase.prototype.onfocusout.apply(this,arguments)};
sap.m.MultiComboBox.prototype.onsapfocusleave=function(e){var p=this.getAggregation("popup");var c=sap.ui.getCore().byId(e.relatedControlId);var f=c&&c.getFocusDomRef();if(p&&f){if(jQuery.sap.equal(p.getFocusDomRef(),f)){this.focus()}}};
sap.m.MultiComboBox.prototype.onsapshow=function(e){e.setMarked();if(e.keyCode===jQuery.sap.KeyCodes.F4){e.preventDefault()}if(this.isOpen()){this.close();return}if(this.hasContent()){this.open()}};
sap.m.MultiComboBox.prototype.onsaphide=sap.m.MultiComboBox.prototype.onsapshow;
sap.m.MultiComboBox.prototype.onsapescape=function(e){e.setMarked();if(this.isOpen()){this.close()}else{sap.m.InputBase.prototype.onsapescape.apply(this,arguments)}};
sap.m.MultiComboBox.prototype.onsapenter=function(e){sap.m.InputBase.prototype.onsapenter.apply(this,arguments);e.setMarked();var v=[];if(this.isOpen()){v=this._getVisibleItems()}else{v=this._getSuggestedItems(this.getValue())}if(v.length===1){var i=v[0];var l=i._oListItem;var p={item:i,id:i.getId(),key:i.getKey(),fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:false};if(l.getTitle().toLowerCase().indexOf(this._getDomValue().toLowerCase())>-1){if(l.isSelected()){this._removeSelectedItem(p);this.setValue('')}else{this._setSelectedItem(p)}}}this.close()};
sap.m.MultiComboBox.prototype.onsapprevious=function(e){if(this.getCursorPosition()===0){if(e.srcControl===this){sap.m.Tokenizer.prototype.onsapprevious.apply(this._oTokenizer,arguments)}}};
sap.m.MultiComboBox.prototype.onsaphome=function(e){var d=this.getDomRef();if(!d){return}var m=jQuery(d);var s=m.find(sap.m.MultiComboBoxRenderer.DOT_CSS_CLASS+"ScrollContainer")[0];s.scrollLeft=0};
sap.m.MultiComboBox.prototype.onsapend=function(e){this._scrollToEnd()};
sap.m.MultiComboBox.prototype.onsapdown=function(e){e.setMarked();e.preventDefault();if(this.isOpen()){var i=this._getVisibleItems()[0];if(i){i._oListItem.focus()}}};
sap.m.MultiComboBox.prototype.onsapbackspace=function(e){if(this.getCursorPosition()>0||this._getDomValue().length>0){return}sap.m.Tokenizer.prototype.onsapbackspace.apply(this._oTokenizer,arguments)};
sap.m.MultiComboBox.prototype.onsapdelete=function(e){if(this.getValue()&&!this._isCompleteTextSelected()){return}sap.m.Tokenizer.prototype.onsapdelete.apply(this._oTokenizer,arguments)};
sap.m.MultiComboBox.prototype.onkeydown=function(e){sap.m.InputBase.prototype.onkeydown.apply(this,arguments);if(this._getDomValue().length===0&&e.ctrlKey&&e.which===jQuery.sap.KeyCodes.A){this._oTokenizer.focus();this._oTokenizer.selectAllTokens(true);e.preventDefault()}};
sap.m.MultiComboBox.prototype.onpaste=function(e){var i=e.target.value;var I="";if(e.originalEvent&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.getData){I=e.originalEvent.clipboardData.getData('text/plain')}this._checkEnteredValue(i+I,e)};
sap.m.MultiComboBox.prototype.onkeypress=function(e){if(jQuery.sap.isSpecialKey(e)){e.preventDefault();return null}var i=this._removeSelection(e.target.value);var I=String.fromCharCode(e.which);this._checkEnteredValue(i+I,e)};
sap.m.MultiComboBox.prototype._removeSelection=function(v){var i=this.getFocusDomRef();var b=i.selectionStart;var e=i.selectionEnd?i.selectionEnd+1:i.selectionEnd;return v.slice(0,b)+v.slice(e)};
sap.m.MultiComboBox.prototype._checkEnteredValue=function(t,e){if(!this._isItemExistsStartingText(t)){e.preventDefault();var v=this.getValueState();if(v===sap.ui.core.ValueState.Error||v===sap.ui.core.ValueState.Success||v===sap.ui.core.ValueState.Warning){this.$().removeClass("sapMInputBase"+v);jQuery.sap.delayedCall(300,this.$(),"addClass",["sapMInputBase"+v])}else{this.$().addClass("sapMInputBaseError");jQuery.sap.delayedCall(300,this.$(),"removeClass",["sapMInputBaseError"])}return false}return true};
sap.m.MultiComboBox.prototype._scrollToEnd=function(){var d=this.getDomRef();if(!d){return}var m=jQuery(d);var s=m.find(sap.m.MultiComboBoxRenderer.DOT_CSS_CLASS+"ScrollContainer")[0];var S=s.scrollWidth-jQuery(s).width();if(S<0){S=0}s.scrollLeft=S};
sap.m.MultiComboBox.prototype._isOpenArea=function(d){var o=this.getDomRef("arrow");return o&&o.contains(d)};
sap.m.MultiComboBox.prototype._isItemExistsStartingText=function(t){return this.getItems().some(function(i){return jQuery.sap.startsWithIgnoreCase(i.getText(),t)})};
sap.m.MultiComboBox.prototype.getCursorPosition=function(){return this._$input.cursorPos()};
sap.m.MultiComboBox.prototype._isCompleteTextSelected=function(){var i=this._$input[0];if(i.selectionStart!==0||i.selectionEnd!==this.getValue().length){return false}return true};
sap.m.MultiComboBox.prototype.addContent=function(p){};
sap.m.MultiComboBox.prototype.getPopup=function(){if(this.bIsDestroyed){return null}return this._createPopupFactory(this._getPopupType())};
sap.m.MultiComboBox.prototype.hasContent=function(){return!!this.getItems().length};
sap.m.MultiComboBox.prototype.onBeforeRenderingPopup=function(){var o=this["_onBeforeRendering"+this._getPopupType()];this._removeFocusableParentPopup(this._getParentPopup());if(o){o.call(this)}};
sap.m.MultiComboBox.prototype.onAfterRenderingPopup=function(){var o=this["_onAfterRendering"+this._getPopupType()];this._addFocusableParentPopup(this._getParentPopup());if(o){o.call(this)}};
sap.m.MultiComboBox.prototype.open=function(){var p=this.getPopup();if(p){p.open()}return this};
sap.m.MultiComboBox.prototype.addItem=function(i){this.addAggregation("items",i);if(this._oList){this._oList.addItem(this._mapItemToListItem(i))}return this};
sap.m.MultiComboBox.prototype.insertItem=function(i,I){this.insertAggregation("items",i,I);if(this._oList){this._oList.insertItem(this._mapItemToListItem(i),I)}return this};
sap.m.MultiComboBox.prototype.setSelectedItems=function(i){if(!i||!i.length){return this}if(!jQuery.isArray(i)){jQuery.sap.log.warning('Warning: setSelectedItems() "aItems" has to be an array of sap.ui.core.Item instances or an array of valid sap.ui.core.Item Ids',this);return this}i.forEach(function(I){if(!(I instanceof sap.ui.core.Item)&&(typeof I!=="string")){jQuery.sap.log.warning('Warning: setSelectedItems() "aItems" has to be an array of sap.ui.core.Item instances or an array of valid sap.ui.core.Item Ids',this);return}if(typeof I==="string"){I=sap.ui.getCore().byId(I)}this._setSelectedItem({item:I?I:null,id:I?I.getId():"",key:I?I.getKey():"",suppressInvalidate:true})},this);return this};
sap.m.MultiComboBox.prototype.addSelectedItem=function(i){if(!i){return this}if(typeof i==="string"){i=sap.ui.getCore().byId(i)}this._setSelectedItem({item:i?i:null,id:i?i.getId():"",key:i?i.getKey():"",suppressInvalidate:true});return this};
sap.m.MultiComboBox.prototype.removeSelectedItem=function(i){if(!i){return null}if(typeof i==="string"){i=sap.ui.getCore().byId(i)}this._removeSelectedItem({item:i,id:i.getId(),key:i.getKey(),suppressInvalidate:true});return i};
sap.m.MultiComboBox.prototype.removeAllSelectedItems=function(){var i=[];var I=this.getAssociation("selectedItems",[]);I.forEach(function(o){var a=this.removeSelectedItem(o);i.push(a)},this);this._aCustomerKeys=[];return i};
sap.m.MultiComboBox.prototype.removeItem=function(i){i=this.removeAggregation("items",i);if(this._oList){this._oList.removeItem(i&&i._oListItem)}this._removeSelectedItem({item:i,id:i.getId(),key:i.getKey(),suppressInvalidate:true,listItemUpdated:true});return i};
sap.m.MultiComboBox.prototype.removeAllItems=function(){var i=this.removeAllAggregation("items");this.removeAllSelectedItems();if(this._oList){this._oList.removeAllItems()}return i};
sap.m.MultiComboBox.prototype.removeSelectedKeys=function(k){var i=[],I;if(!k||!k.length||!jQuery.isArray(k)){return i}var o;k.forEach(function(K){o=this.getItemByKey(K);if(o){this._removeSelectedItem({item:o?o:null,id:o?o.getId():"",key:o?o.getKey():"",suppressInvalidate:true});i.push(o)}if(this._aCustomerKeys.length&&(I=this._aCustomerKeys.indexOf(K))>-1){this._aCustomerKeys.splice(I,1)}},this);return i};
sap.m.MultiComboBox.prototype.setSelectedKeys=function(k){this.removeAllSelectedItems();this.addSelectedKeys(k);return this};
sap.m.MultiComboBox.prototype.addSelectedKeys=function(k){if(!k||!k.length||!jQuery.isArray(k)){return this}if(!jQuery.isArray(k)||typeof k[0]!=="string"){jQuery.sap.log.warning('Warning: addSelectedKeys() "aKeys" has to be an array of string',this);return this}k.forEach(function(K){var i=this.getItemByKey(K);if(i){this.addSelectedItem(i)}else if(K){this._aCustomerKeys.push(K)}},this);return this};
sap.m.MultiComboBox.prototype.getSelectedKeys=function(){var i=this.getSelectedItems()||[],k=[];i.forEach(function(I){k.push(I.getKey())},this);if(this._aCustomerKeys.length){k=k.concat(this._aCustomerKeys)}return k};
sap.m.MultiComboBox.prototype.getSelectedItems=function(){var i=[],I=this.getAssociation("selectedItems")||[];I.forEach(function(s){i.push(sap.ui.getCore().byId(s))},this);return i};
sap.m.MultiComboBox.prototype.getItemByKey=function(k){for(var i=0,I=this.getItems();i<I.length;i++){if(I[i].getKey()===k){return I[i]}}return null};
sap.m.MultiComboBox.prototype.getWidth=function(){return this.getProperty("width")||"100%"};
sap.m.MultiComboBox.prototype.destroyItems=function(){this.destroyAggregation("items");if(this._oList){this._oList.destroyItems()}return this};
sap.m.MultiComboBox.prototype.isOpen=function(){var p=this.getAggregation("popup");return!!(p&&p.isOpen())};
sap.m.MultiComboBox.prototype.close=function(){var p=this.getAggregation("popup");if(p){p.close()}this.focus();return this};
sap.m.MultiComboBox.prototype._getParentPopup=function(){var m=this.$();return(m&&m.closest("[data-sap-ui-popup]"))||null};
sap.m.MultiComboBox.prototype._addFocusableParentPopup=function(d){sap.m.MultiComboBox._publishEventToPopup({action:"add",child:this.getAggregation("popup"),parent:d})};
sap.m.MultiComboBox.prototype._removeFocusableParentPopup=function(d){sap.m.MultiComboBox._publishEventToPopup({action:"remove",child:this.getAggregation("popup"),parent:d})};
sap.m.MultiComboBox._publishEventToPopup=function(o){var p,e;if(!o.parent||!o.child){return}p=o.parent.attr("data-sap-ui-popup");e="sap.ui.core.Popup."+o.action+"FocusableContent"+"-"+p;sap.ui.getCore().getEventBus().publish("sap.ui",e,{id:o.child.getId()})};
sap.m.MultiComboBox.prototype._synchronizeSelectedItemAndKey=function(I){if(!I.length){jQuery.sap.log.info("Info: _synchronizeSelectedItemAndKey() the MultiComboBox control does not contain any item on ",this);return}var s=this.getSelectedKeys();var k=this._getKeyOfItems(this.getSelectedItems());if(s){for(var i=0,K=null,o=null,a=null,l=s.length;i<l;i++){K=s[i];if(k.indexOf(K)>-1){if(this._aCustomerKeys.length&&(a=this._aCustomerKeys.indexOf(K))>-1){this._aCustomerKeys.splice(a,1)}continue}o=this.getItemByKey(""+K);if(o){if(this._aCustomerKeys.length&&(a=this._aCustomerKeys.indexOf(K))>-1){this._aCustomerKeys.splice(a,1)}this._setSelectedItem({item:o,id:o.getId(),key:o.getKey(),fireChangeEvent:false,suppressInvalidate:true,listItemUpdated:false})}}return}};
