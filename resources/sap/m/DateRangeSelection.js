/*!
 * SAP UI development toolkit for HTML5 (SAPUI5/OpenUI5)
 * (c) Copyright 2009-2014 SAP SE or an SAP affiliate company. 
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
jQuery.sap.declare("sap.m.DateRangeSelection");jQuery.sap.require("sap.m.library");jQuery.sap.require("sap.m.DatePicker");sap.m.DatePicker.extend("sap.m.DateRangeSelection",{metadata:{library:"sap.m",properties:{"delimiter":{type:"string",group:"Misc",defaultValue:'-'},"secondDateValue":{type:"object",group:"Data",defaultValue:null},"from":{type:"object",group:"Misc",defaultValue:null,deprecated:true},"to":{type:"object",group:"Misc",defaultValue:null,deprecated:true}},events:{"change":{}}}});sap.m.DateRangeSelection.M_EVENTS={'change':'change'};(function(){sap.m.DateRangeSelection.prototype.init=function(){sap.m.DatePicker.prototype.init.apply(this,arguments);this._bIntervalSelection=true};sap.m.DateRangeSelection.prototype._getPlaceholder=function(){var p=this.getPlaceholder();if(!p){p=this.getDisplayFormat();if(!p){p="medium"}if(p==="short"||p==="medium"||p==="long"){var l=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();var L=sap.ui.core.LocaleData.getInstance(l);p=L.getDatePattern(p)}var t=this;var d=c(t);if(d&&d!==""){p=p+" "+d+" "+p}}return p};sap.m.DateRangeSelection.prototype.setValue=function(v){if(v!==this.getValue()){this._lastValue=v}else{return this}this.setProperty("value",v,true);var d=[undefined,undefined];d=this._parseValue(v);d=a(this,d[0],d[1]);this.setProperty("dateValue",d[0],true);this.setProperty("secondDateValue",d[1],true);if(this.getDomRef()){var o=this._formatValue(d[0],d[1]);if(this._$input.val()!==o){this._$input.val(o);this._setLabelVisibility();this._curpos=this._$input.cursorPos()}}return this};sap.m.DateRangeSelection.prototype.setFrom=function(f){this.setDateValue(f)};sap.m.DateRangeSelection.prototype.getFrom=function(){return this.getDateValue()};sap.m.DateRangeSelection.prototype.setTo=function(t){this.setSecondDateValue(t)};sap.m.DateRangeSelection.prototype.getTo=function(){return this.getSecondDateValue()};sap.m.DateRangeSelection.prototype.setDateValue=function(d){if(jQuery.sap.equal(this.getDateValue(),d)){return this}this.setProperty("dateValue",d,true);var s=this.getSecondDateValue();var v=this._formatValue(d,s);if(v!==this.getValue()){this._lastValue=v}this.setProperty("value",v,true);if(this.getDomRef()){var o=this._formatValue(d,s);if(this._$input.val()!==o){this._$input.val(o);this._setLabelVisibility();this._curpos=this._$input.cursorPos()}}return this};sap.m.DateRangeSelection.prototype.setSecondDateValue=function(s){if(jQuery.sap.equal(this.getSecondDateValue(),s)){return this}this.setProperty("secondDateValue",s,true);var d=this.getDateValue();var v=this._formatValue(d,s);if(v!==this.getValue()){this._lastValue=v}this.setProperty("value",v,true);if(this.getDomRef()){var o=this._formatValue(d,s);if(this._$input.val()!==o){this._$input.val(o);this._setLabelVisibility();this._curpos=this._$input.cursorPos()}}return this};sap.m.DateRangeSelection.prototype._parseValue=function(v){var i="";var f;var d=[];var D,o;var t=this;var s=c(t);if((s&&s!=="")&&v){d=v.split(s);if(d.length===2){if(d[0].slice(d[0].length-1,d[0].length)==" "){d[0]=d[0].slice(0,d[0].length-1)}if(d[1].slice(0,1)==" "){d[1]=d[1].slice(1)}}else{d=v.split(" "+s+" ")}if(d.length<2){var e=v.split(" ");if(e.length===2){d=e}}}if(v&&d.length<=2){i=this.getDisplayFormat();if(!i){i="medium"}if(i==="short"||i==="medium"||i==="long"){f=sap.ui.core.format.DateFormat.getInstance({style:i})}else{f=sap.ui.core.format.DateFormat.getInstance({pattern:i})}if((!s||s==="")||d.length===1){D=f.parse(v)}else if(d.length===2){if((f.parse(d[0])===null)||(f.parse(d[1])===null)){}else{D=f.parse(d[0]);o=f.parse(d[1])}}}return[D,o]};sap.m.DateRangeSelection.prototype._formatValue=function(d,s){var v="";var t=this;var D=c(t);if(d){var o="";var f;o=this.getDisplayFormat();if(!o){o="medium"}if(o==="short"||o==="medium"||o==="long"){f=sap.ui.core.format.DateFormat.getInstance({style:o})}else{f=sap.ui.core.format.DateFormat.getInstance({pattern:o})}if(D&&D!==""&&s){v=f.format(d)+" "+D+" "+f.format(s)}else{v=f.format(d)}}return v};sap.m.DateRangeSelection.prototype.onChange=function(){if(!this.getEditable()||!this.getEnabled()){return}var v=this._$input.val();var d=[undefined,undefined];if(v!=""){d=this._parseValue(v);d=a(this,d[0],d[1]);v=this._formatValue(d[0],d[1])}if((v!==this._lastValue)||(v==="")){if(this.getDomRef()){this._$input.val(v)}this.setProperty("value",v,true);this.setProperty("dateValue",d[0],true);this.setProperty("secondDateValue",d[1],true);this._curpos=this._$input.cursorPos();this._setLabelVisibility();this._lastValue=v;if(this._oPopup&&this._oPopup.isOpen()){var s=this.getDateValue();if(s){if(!this._oDateRange.getStartDate()||this._oDateRange.getStartDate().getTime()!==s.getTime()){this._oDateRange.setStartDate(new Date(s.getTime()));this._oCalendar.focusDate(s)}}else{if(this._oDateRange.getStartDate()){this._oDateRange.setStartDate(undefined)}}var e=this.getSecondDateValue();if(e){if(!this._oDateRange.getEndDate()||this._oDateRange.getEndDate().getTime()!==e.getTime()){this._oDateRange.setEndDate(new Date(e.getTime()));this._oCalendar.focusDate(e)}}else{if(this._oDateRange.getEndDate()){this._oDateRange.setEndDate(undefined)}}}_(this)}};sap.m.DateRangeSelection.prototype._getInputValue=function(v){v=(typeof v=="undefined")?this._$input.val():v.toString();var d=this._parseValue(v);v=this._formatValue(d[0],d[1]);return v};sap.m.DateRangeSelection.prototype.updateDomValue=function(v){this._bCheckDomValue=true;v=(typeof v=="undefined")?this._$input.val():v.toString();this._curpos=this._$input.cursorPos();var d=this._parseValue(v);v=this._formatValue(d[0],d[1]);if(this.isActive()&&(this._$input.val()!==v)){this._$input.val(v);this._$input.cursorPos(this._curpos)}this._setLabelVisibility();return this};sap.m.DateRangeSelection.prototype._setLabelVisibility=function(){if(!this._bShowLabelAsPlaceholder||!this._$label||!this.isActive()){return}var v=this._$input.val();this._$label.css("display",v?"none":"inline")};sap.m.DateRangeSelection.prototype.onsappageup=function(){};sap.m.DateRangeSelection.prototype.onsappageupmodifiers=function(){};sap.m.DateRangeSelection.prototype.onsappagedown=function(){};sap.m.DateRangeSelection.prototype.onsappagedownmodifiers=function(){};sap.m.DateRangeSelection.prototype._fillDateRange=function(){sap.m.DatePicker.prototype._fillDateRange.apply(this,arguments);var e=this.getSecondDateValue();if(e){if(!this._oDateRange.getEndDate()||this._oDateRange.getEndDate().getTime()!==e.getTime()){this._oDateRange.setEndDate(new Date(e.getTime()))}}else{if(this._oDateRange.getEndDate()){this._oDateRange.setEndDate(undefined)}}};sap.m.DateRangeSelection.prototype._selectDate=function(e){var s=this._oCalendar.getSelectedDates();if(s.length>0){var d=s[0].getStartDate();var D=s[0].getEndDate();var l=this._lastValue;if(d&&D){var o=this.getDateValue();var f=this.getSecondDateValue();this._oPopup.close();this._bFocusNoPopup=true;this.focus();this.setProperty("dateValue",d,true);this.setSecondDateValue(D);if(!jQuery.sap.equal(d,o)||!jQuery.sap.equal(D,f)){var v=this.getValue();var t=this;_(t);this._curpos=v.length;this._$input.cursorPos(this._curpos)}if(sap.ui.Device.browser.mobile){window.document.activeElement.blur()}}}};function _(t){t.fireChange({from:t.getDateValue(),to:t.getSecondDateValue()})};function a(t,d,s){if(d&&s&&d.getTime()>s.getTime()){var T=d;d=s;s=T}return[d,s]};function b(f,t){if(f.getTime()<t.getTime()){return true}return false};function c(t){var d=t.getDelimiter();if(!d){if(!t._sLocaleDelimiter){var l=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();var L=sap.ui.core.LocaleData.getInstance(l);var p=L.getIntervalPattern();var i=p.indexOf("{0}")+3;var I=p.indexOf("{1}");d=p.slice(i,I);if(d.length>1){if(d.slice(0,1)==" "){d=d.slice(1)}if(d.slice(d.length-1,d.length)==" "){d=d.slice(0,d.length-1)}}t._sLocaleDelimiter=d}else{d=t._sLocaleDelimiter}}return d}}());
