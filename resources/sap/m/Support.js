/*!
 * SAP UI development toolkit for HTML5 (SAPUI5/OpenUI5)
 * (c) Copyright 2009-2014 SAP SE or an SAP affiliate company. 
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
jQuery.sap.declare("sap.m.Support");sap.m.Support=(function($,d){var a,s,b,l;var t=0;var m=3000;var h=2;var c=3;var r=1,D={},e={btnStart:"startE2ETrace",selLevel:"logLevelE2ETrace",taContent:"outputE2ETrace",infoText:"Ent-to-End trace is running in the background."+" Navigate to the URL that you would like to trace."+" The result of the trace will be shown in dialog after the trace is terminated.",infoDuration:5000},f={dvLoadedLibs:"LoadedLibs",dvLoadedModules:"LoadedModules"};function g(i,v,y,z,A){i.push("<tr class='sapUiSelectable'><td class='sapUiSupportTechInfoBorder sapUiSelectable'><label class='sapUiSupportLabel sapUiSelectable'>",jQuery.sap.escapeHTML(z),"</label><br>");var B=A;if($.isFunction(A)){B=A(i)||""}i.push($.sap.escapeHTML(B));i.push("</td></tr>")}function j(y,z,A,B,C){g(y,z,A,B,function(y){y.push("<table class='sapMSupportTable' border='0' cellspacing='5' cellpadding='5' width='100%'><tbody>");$.each(C,function(i,v){var E="";if(v){if(typeof(v)=="string"||typeof(v)=="boolean"||($.isArray(v)&&v.length==1)){E=v}else if(($.isArray(v)||$.isPlainObject(v))&&window.JSON){E=window.JSON.stringify(v)}}g(y,false,false,i,""+E)});y.push("</tbody></table>")})}function k(){var y,C=sap.ui.getCore().getConfiguration();var L={};jQuery.each(sap.ui.getCore().getLoadedLibraries(),function(N,i){L[N]=i.version});D={version:sap.ui.version,build:sap.ui.buildinfo.buildtime,change:sap.ui.buildinfo.lastchange,useragent:navigator.userAgent,docmode:d.documentMode||"",debug:$.sap.debug(),bootconfig:window["sap-ui-config"]||{},modules:$.sap.getAllDeclaredModules(),loadedlibs:L,uriparams:$.sap.getUriParameters().mParams,appurl:window.location.href,config:{theme:C.getTheme(),language:C.getLanguage(),formatLocale:C.getFormatLocale(),accessibility:""+C.getAccessibility(),animation:""+C.getAnimation(),rtl:""+C.getRTL(),debug:""+C.getDebug(),inspect:""+C.getInspect(),originInfo:""+C.getOriginInfo(),noDuplicateIds:""+C.getNoDuplicateIds()}};y=["<table class='sapUiSelectable' border='0' cellspacing='5' cellpadding='5' width='100%'><tbody class='sapUiSelectable'>"];g(y,true,true,"SAPUI5 Version",function(i){i.push(D.version," (built at ",D.build,", last change ",D.change,")")});g(y,true,true,"User Agent",function(i){i.push(D.useragent,(D.docmode?", Document Mode '"+D.docmode+"'":""))});g(y,true,true,"Debug Sources",function(i){i.push((D.debug?"ON":"OFF"))});g(y,true,true,"Application",D.appurl);j(y,true,true,"Configuration (bootstrap)",D.bootconfig);j(y,true,true,"Configuration (computed)",D.config);j(y,true,true,"URI Parameters",D.uriparams);g(y,true,true,"End-to-End Trace",function(i){i.push("<label class='sapUiSupportLabel'>Trace Level:</label>","<select id='"+n(e.selLevel)+"' class='sapUiSupportTxtFld' >","<option value='low'>LOW</option>","<option value='medium' selected>MEDIUM</option>","<option value='high'>HIGH</option>","</select>");i.push("<button id='"+n(e.btnStart)+"' class='sapUiSupportBtn'>Start</button>");i.push("<div class='sapUiSupportDiv'>");i.push("<label class='sapUiSupportLabel'>XML Output:</label>");i.push("<textarea id='"+n(e.taContent)+"' class='sapUiSupportTxtArea sapUiSelectable' readonly ></textarea>");i.push("</div>")});g(y,true,true,"Loaded Libraries",function(z){z.push("<ul class='sapUiSelectable'>");$.each(D.loadedlibs,function(i,v){if(v&&(typeof(v)==="string"||typeof(v)==="boolean")){z.push("<li class='sapUiSelectable'>",i+" "+v,"</li>")}});z.push("</ul>")});g(y,true,true,"Loaded Modules",function(i){i.push("<div class='sapUiSupportDiv sapUiSelectable' id='"+n(f.dvLoadedModules)+"' />")});y.push("</tbody></table>");return new sap.ui.core.HTML({content:y.join("").replace(/\{/g,"&#123;").replace(/\}/g,"&#125;")})}function n(i){return a.getId()+"-"+i}function o(v,y){var z="Modules";var A=0,B=[];A=y.length;$.each(y.sort(),function(i,E){B.push(new sap.m.Label({text:" - "+E}).addStyleClass("sapUiSupportPnlLbl"))});var C=new sap.m.Panel({expandable:true,expanded:false,headerToolbar:new sap.m.Toolbar({design:sap.m.ToolbarDesign.Transparent,content:[new sap.m.Label({text:z+" ("+A+")",design:sap.m.LabelDesign.Bold})]}),content:B});C.placeAt(n(v),"only")}function p(){if(a.traceXml){a.$(e.taContent).text(a.traceXml)}if(a.e2eLogLevel){a.$(e.selLevel).val(a.e2eLogLevel)}o(f.dvLoadedModules,D.modules);a.$(e.btnStart).bind("tap",function(){a.e2eLogLevel=a.$(e.selLevel).val();a.$(e.btnStart).addClass("active").text("Running...");a.traceXml="";a.$(e.taContent).text("");if(!jQuery.sap.isDeclared("sap.ui.core.support.trace.E2eTraceLib")){jQuery.sap.require("sap.ui.core.support.trace.E2eTraceLib")}sap.ui.core.support.trace.E2eTraceLib.start(a.e2eLogLevel,function(i){a.traceXml=i});if(!jQuery.sap.isDeclared("sap.m.MessageToast")){jQuery.sap.require("sap.m.MessageToast")}sap.m.MessageToast.show(e.infoText,{duration:e.infoDuration});a.close()})}function q(){if(a){return a}$.sap.require("sap.m.Dialog");$.sap.require("sap.m.Button");$.sap.require("sap.ui.core.HTML");a=new sap.m.Dialog({title:"Technical Information",horizontalScrolling:true,verticalScrolling:true,stretch:jQuery.device.is.phone,leftButton:new sap.m.Button({text:"Close",type:"Reject",press:function(){a.close()}}),afterOpen:function(){sap.m.Support.off()},afterClose:function(){sap.m.Support.on()}}).addStyleClass("sapMSupport");return a}function u(E){if(E.touches){var i=E.touches.length;if(i>c){d.removeEventListener('touchend',w);return}switch(i){case h:s=Date.now();d.addEventListener('touchend',w);break;case c:if(s){t=Date.now()-s;l=E.touches[i-1].identifier}break}}}function w(E){d.removeEventListener('touchend',w);if(t>m&&E.touches.length===h&&E.changedTouches.length===r&&E.changedTouches[0].identifier===l){t=0;s=0;x()}}function x(){var i=q();i.removeAllAggregation("content");i.addAggregation("content",k());a.open();p()}return({on:function(){if(!b&&"ontouchstart"in d){b=true;d.addEventListener("touchstart",u)}return this},off:function(){if(b){b=false;d.removeEventListener("touchstart",u)}return this},open:function(){x()}}).on()}(jQuery,document));
